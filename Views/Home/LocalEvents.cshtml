@model IEnumerable<PROG7312_POE.Models.LocalEvent>

@{
    ViewData["Title"] = "Local Events";
}

<!-- Page Header -->
<div class="report-header">
    <div class="container">
        <a href="@Url.Action("Index", "Home")" class="back-link">← Back to Home</a>
        <h1 class="page-title">Local Events & Announcements</h1>
        <p class="page-subtitle">Stay informed about community events, municipal announcements, and activities in Cape Town.</p>
    </div>
</div>

<!-- Page Content -->
<div class="report-content">
    <div class="container">
        
        <!-- Search and Filter Section -->
        <div class="form-card">
            <h3>Find Events</h3>
            <p class="subtitle">Search for events by category, date, or location.</p>
            
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label">🔍 Search Events</label>
                    <input type="text" class="form-control" id="searchInput" placeholder="Search events...">
                </div>
                <div class="col-md-4">
                    <label class="form-label">📂 Category</label>
                    <select class="form-select" id="categoryFilter">
                        <option value="">All Categories</option>
                        <option value="Community">Community</option>
                        <option value="Sports">Sports & Recreation</option>
                        <option value="Arts">Arts & Culture</option>
                        <option value="Education">Education</option>
                        <option value="Health">Health & Wellness</option>
                        <option value="Environment">Environment</option>
                        <option value="Municipal">Municipal Meetings</option>
                        <option value="Safety">Public Safety</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label class="form-label">📅 Date Range</label>
                    <select class="form-select" id="dateFilter">
                        <option value="">All Dates</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                        <option value="upcoming">Upcoming</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Featured Events Section -->
        <div class="info-card">
            <h3>Featured Events</h3>
            
            @if (Model != null && Model.Any())
            {
                <p class="subtitle">📊 Displaying @Model.Count() events from Dictionary-based repository</p>
            }
            
            <div class="row g-4" id="featuredEvents">
                
                @if (Model != null && Model.Any())
                {
                    foreach (var evt in Model)
                    {
                        var categoryClass = evt.Category.ToLower() switch
                        {
                            "community" => "event-badge-community",
                            "arts" => "event-badge-arts",
                            "municipal" => "event-badge-municipal",
                            "sports" => "event-badge-sports",
                            "health" => "event-badge-health",
                            "environment" => "event-badge-environment",
                            _ => "event-badge-community"
                        };
                        
                        <div class="col-md-6 col-lg-4">
                            <div class="event-card" data-category="@evt.Category" data-date="@evt.EventDate.ToString("yyyy-MM-dd")" data-event-id="@evt.Id">
                                <div class="event-badge @categoryClass">@evt.Category</div>
                                <div class="event-date">
                                    <div class="event-day">@evt.EventDate.Day</div>
                                    <div class="event-month">@evt.EventDate.ToString("MMM").ToUpper()</div>
                                </div>
                                <h4 class="event-title">@evt.Title</h4>
                                <div class="event-details">
                                    <div class="event-detail-item">
                                        <span class="event-icon">🕐</span>
                                        <span>@evt.EventDate.ToString("h:mm tt")</span>
                                    </div>
                                    <div class="event-detail-item">
                                        <span class="event-icon">📍</span>
                                        <span>@evt.Location</span>
                                    </div>
                                </div>
                                <p class="event-description">@evt.Description</p>
                                <button class="btn-event-details" data-event-id="@evt.Id">View Details</button>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="col-12">
                        <div style="text-align: center; padding: 40px; color: #666;">
                            <div style="font-size: 3rem; margin-bottom: 20px;">📅</div>
                            <h4>No Events Available</h4>
                            <p>Dictionary is empty. Events will be seeded on next page load.</p>
                        </div>
                    </div>
                }

            </div>

            <!-- No Results Message -->
            <div id="noResults" style="display: none; text-align: center; padding: 40px; color: #666;">
                <div style="font-size: 3rem; margin-bottom: 20px;">📅</div>
                <h4>No Events Found</h4>
                <p>Try adjusting your search criteria or filters.</p>
            </div>
        </div>

        <!-- Information Cards Row -->
        <div class="info-cards-row">
            <!-- Event Categories Card -->
            <div class="process-card">
                <h3>Event Categories</h3>
                
                <div class="category-list">
                    <div class="category-item">
                        <span class="category-icon">👥</span>
                        <div>
                            <strong>Community Events</strong>
                            <p>Neighborhood meetings, clean-ups, and social gatherings</p>
                        </div>
                    </div>
                    <div class="category-item">
                        <span class="category-icon">🎨</span>
                        <div>
                            <strong>Arts & Culture</strong>
                            <p>Markets, exhibitions, performances, and festivals</p>
                        </div>
                    </div>
                    <div class="category-item">
                        <span class="category-icon">🏃</span>
                        <div>
                            <strong>Sports & Recreation</strong>
                            <p>Marathons, tournaments, and fitness activities</p>
                        </div>
                    </div>
                    <div class="category-item">
                        <span class="category-icon">🏛️</span>
                        <div>
                            <strong>Municipal Meetings</strong>
                            <p>Public consultations and council meetings</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Subscribe Card -->
            <div class="process-card">
                <h3>Stay Updated</h3>
                
                <p>Subscribe to receive notifications about upcoming events in your area.</p>
                
                <div class="subscribe-form">
                    <label class="form-label">📧 Email Address</label>
                    <input type="email" class="form-control" placeholder="your.email@example.com">
                    
                    <label class="form-label" style="margin-top: 15px;">📍 Preferred Areas</label>
                    <select class="form-select" multiple size="4">
                        <option>City Centre</option>
                        <option>Northern Suburbs</option>
                        <option>Southern Suburbs</option>
                        <option>Atlantic Seaboard</option>
                        <option>Cape Flats</option>
                    </select>
                    
                    <button class="btn-submit" style="margin-top: 20px; width: 100%;">Subscribe to Updates</button>
                </div>

                <p class="response-note" style="margin-top: 15px;">
                    You can unsubscribe at any time. We respect your privacy.
                </p>
            </div>
        </div>

    </div>
</div>

<!-- Dictionary Debug Info (remove in production) -->
@if (Model != null)
{
    <div class="alert alert-success" role="alert">
        <strong>✅ Dictionary Active!</strong><br/>
        <small>
            - Total events in model: @Model.Count()<br/>
            - Events are stored in: Dictionary&lt;string, LocalEvent&gt;, SortedDictionary&lt;DateTime, List&lt;LocalEvent&gt;&gt;<br/>
            - Categories: @string.Join(", ", Model.Select(e => e.Category).Distinct())
        </small>
    </div>
}
else
{
    <div class="alert alert-danger" role="alert">
        <strong>❌ Dictionary NOT working!</strong> Model is null.
    </div>
}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('searchInput');
        const categoryFilter = document.getElementById('categoryFilter');
        const dateFilter = document.getElementById('dateFilter');
        const eventCards = document.querySelectorAll('.event-card');
        const noResults = document.getElementById('noResults');

        function filterEvents() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedCategory = categoryFilter.value;
            const selectedDate = dateFilter.value;
            let visibleCount = 0;

            eventCards.forEach(card => {
                const title = card.querySelector('.event-title').textContent.toLowerCase();
                const description = card.querySelector('.event-description').textContent.toLowerCase();
                const category = card.dataset.category;
                const eventDate = new Date(card.dataset.date);
                const today = new Date();

                // Search filter
                const matchesSearch = searchTerm === '' || 
                    title.includes(searchTerm) || 
                    description.includes(searchTerm);

                // Category filter
                const matchesCategory = selectedCategory === '' || category === selectedCategory;

                // Date filter
                let matchesDate = true;
                if (selectedDate === 'today') {
                    matchesDate = eventDate.toDateString() === today.toDateString();
                } else if (selectedDate === 'week') {
                    const weekFromNow = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
                    matchesDate = eventDate >= today && eventDate <= weekFromNow;
                } else if (selectedDate === 'month') {
                    const monthFromNow = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
                    matchesDate = eventDate >= today && eventDate <= monthFromNow;
                } else if (selectedDate === 'upcoming') {
                    matchesDate = eventDate >= today;
                }

                // Show or hide card
                if (matchesSearch && matchesCategory && matchesDate) {
                    card.parentElement.style.display = 'block';
                    visibleCount++;
                } else {
                    card.parentElement.style.display = 'none';
                }
            });

            // Show "no results" message if no cards are visible
            noResults.style.display = visibleCount === 0 ? 'block' : 'none';
        }

        // Add event listeners
        searchInput.addEventListener('input', filterEvents);
        categoryFilter.addEventListener('change', filterEvents);
        dateFilter.addEventListener('change', filterEvents);

        // Event details button handlers
        document.querySelectorAll('.btn-event-details').forEach(button => {
            button.addEventListener('click', function() {
                const eventCard = this.closest('.event-card');
                const eventTitle = eventCard.querySelector('.event-title').textContent;
                alert(`Event details for: ${eventTitle}\n\nMore details coming soon!`);
            });
        });
    });
</script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}